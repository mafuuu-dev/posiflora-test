# MVP: Telegram Integration (Growth Feature)

## 1. Цель задания

Проверить способность кандидата быстро запускать MVP-фичи в
Growth-формате:

-   Сквозное fullstack-мышление (UI → API → DB → внешняя интеграция)
-   Аккуратность в данных и идемпотентности
-   Умение работать с внешними API
-   Минимальные DevOps-навыки (Docker)

------------------------------------------------------------------------

## 2. Технологии (на выбор кандидата)

**Frontend:** React + TypeScript (желательно)\
**Backend:** PHP (Symfony-style) или Go\
**DB:** PostgreSQL / MySQL / SQLite\
**Инфраструктура:** Docker (желательно)

------------------------------------------------------------------------

## 3. Контекст

MVP интеграции Telegram-бота для магазинов Posiflora.

### Growth-гипотеза:

> Если магазин сможет быстро подключить Telegram-бота и получать
> уведомления о новых заказах --- это повысит ежедневную активность и
> удержание владельцев.

Необходимо реализовать:

-   Подключение Telegram-бота (botToken + chatId)
-   Отправку уведомлений о новых заказах
-   Панель статуса интеграции

------------------------------------------------------------------------

## 4. Модель данных

### Таблицы

``` sql
shops(
  id,
  name
)

telegram_integrations(
  id,
  shop_id,
  bot_token text,
  chat_id text,
  enabled boolean,
  created_at,
  updated_at,
  unique(shop_id)
)

orders(
  id,
  shop_id,
  number text,
  total numeric,
  customer_name text,
  created_at timestamp
)

telegram_send_log(
  id,
  shop_id,
  order_id,
  message text,
  status enum('SENT','FAILED'),
  error text,
  sent_at timestamp,
  unique(shop_id, order_id)
)
```

### Seed

-   Минимум 1 магазин
-   5--10 тестовых заказов

------------------------------------------------------------------------

## 5. Backend API

### 5.1 Подключение Telegram

**POST** `/shops/{shopId}/telegram/connect`

``` json
{
  "botToken": "123456:ABC-DEF...",
  "chatId": "987654321",
  "enabled": true
}
```

Правила:

-   Upsert по shopId
-   Валидация botToken и chatId
-   Обновление updated_at

Ответ: сохранённая конфигурация интеграции

------------------------------------------------------------------------

### 5.2 Создание заказа

**POST** `/shops/{shopId}/orders`

``` json
{
  "number": "A-1005",
  "total": 2490,
  "customerName": "Анна"
}
```

Логика:

1.  Создать заказ
2.  Если интеграция включена --- отправить уведомление
3.  Идемпотентность по (shopId, orderId)
4.  Логирование SENT / FAILED

Ответ:

``` json
{
  "order": {...},
  "telegramStatus": "sent | failed | skipped"
}
```

------------------------------------------------------------------------

### 5.3 Статус интеграции

**GET** `/shops/{shopId}/telegram/status`

Возвращает:

-   enabled
-   chatId (частично маскированный)
-   lastSentAt
-   sentCount (7 дней)
-   failedCount (7 дней)

------------------------------------------------------------------------

## 6. Telegram отправка

Telegram Bot API:

    POST https://api.telegram.org/bot{token}/sendMessage

Body:

``` json
{
  "chat_id": "...",
  "text": "..."
}
```

Требования:

-   Интерфейс `TelegramClient`
-   Возможность mock-режима
-   В README описать, как включить реальную отправку

------------------------------------------------------------------------

## 7. Frontend

Страница:

    /shops/:shopId/growth/telegram

Содержит:

-   Поле botToken
-   Поле chatId
-   Тумблер enabled
-   Кнопка «Сохранить»
-   Блок статуса интеграции
-   Подсказка «как узнать chatId»

Дизайн не оценивается.

------------------------------------------------------------------------

## 8. Нефункциональные требования

-   Разделение слоёв: handler → service → repository → TelegramClient
-   Идемпотентность через unique constraint или проверку
-   Ошибки Telegram не должны ломать создание заказа

------------------------------------------------------------------------

## 9. Инфраструктура

Минимум:

-   Dockerfile (backend)
-   docker-compose.yml (backend + db)

Цель --- показать быструю упаковку MVP.

------------------------------------------------------------------------

## 10. Тесты

Минимум 3 backend-теста:

1.  При создании заказа вызывается TelegramClient и пишется SENT.
2.  Повторная отправка не создаёт дублей (идемпотентность).
3.  При ошибке Telegram пишется FAILED, заказ создаётся.

------------------------------------------------------------------------

## Критерий успеха

Минимально рабочий MVP с корректной бизнес-логикой, изолированной
архитектурой и упакованный в Docker.

------------------------------------------------------------------------

# Документация по проекту

## Обзор

В данном проекте используется **Makefile** как слой оркестрации поверх
Docker Compose. Всё управление окружением и операции с фронтендом
стандартизированы через команды make.

- Фикстуры загружаются во время создания базы сразу после создания таблиц.
- Переменные окружения для тестового прогона находятся в **.docker/.env [TEST_BOT_TOKEN, TEST_CHAT_ID]**.
- Реализована реальная отправка сообщений в телеграм.

------------------------------------------------------------------------

## Процесс запуска приложения

### `make setup up logs`

Первоначальная настройка, запуск приложения и просмотр логов.

------------------------------------------------------------------------

## Команды окружения

### `make setup`

Полная инициализация окружения.

Используйте эту команду для первоначальной настройки.

------------------------------------------------------------------------

### `make up`

Запуск окружения в фоновом (detached) режиме.

Контейнеры пересоздаются и запускаются в фоне.

------------------------------------------------------------------------

### `make stop`

Остановка запущенных контейнеров без удаления томов.

------------------------------------------------------------------------

### `make restart`

Перезапуск окружения.

------------------------------------------------------------------------

### `make down`

Полное удаление окружения.

⚠ Внимание: тома и сохранённые данные будут удалены.

------------------------------------------------------------------------

### `make build`

Пересборка Docker-образов без использования кэша.

------------------------------------------------------------------------

### `make logs`

Просмотр логов контейнеров в режиме реального времени.

Полезно для отладки и мониторинга во время выполнения.

------------------------------------------------------------------------

## Команды приложения

### `make app.test`

Запуск E2E тестов.

------------------------------------------------------------------------

## Команды фронтенда

### `make frontend.env`

Создание конфигурационного файла окружения для фронтенда.

------------------------------------------------------------------------

### `make frontend.install`

Установка npm-зависимостей фронтенда внутри Docker-контейнера.




